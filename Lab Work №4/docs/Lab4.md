# Лабораторная работа №4
**Тема:** Проектирование REST API
 
**Цель работы:** Получить опыт проектирования программного интерфейса.
## Документация по API
### Аутентификация и авторизация
1. Аутентификация пользователя
   - **Метод:** POST
   - **URL:** /authenticate
   - **Описание:** Аутентификация пользователя по логину и паролю.
   - **Параметры запроса:**
     - `login` (строка, обязательно): Логин пользователя
     - `password` (строка, обязательно): Пароль пользователя.
   - **Ответ:** token (string): Токен аутентификации для последующих запросов.
   - **Возможные коды ответов:**
      - 200 OK: Успешная аутентификация.
      - 401 Unauthorized: Неверные учетные данные.
 
### Учетные записи пользователей
1. Создание учетной записи пользователя
   - **Метод:** POST
   - **URL:** /user
   - **Описание:** Создание новой учетной записи пользователя.
   - **Параметры запроса:**
     - `login` (строка, обязательно): Логин пользователя
     - `password` (строка, обязательно): Пароль пользователя.
     - `name` (строка, обязательно): Имя пользователя
     - `role` (строка, обязательно): Роль пользователя (подрядчик или представитель УСК).
   - **Ответ:** Идентификатор нового пользователя. Формат -  JSON
   - **Возможные коды ответов:**
      - 200 OK
      - 400 Bad Request: Пользователь с таким логином уже существует.
      - 422 Validation Error: Некорректный формат данных
        
    **Пример запроса:**
     ```json
    {
       "login": "john_doe",
       "password": "qwerty123",
       "name": "John Doe",
       "role": "подрядчик"
    }
     ```
     
     **Пример ответа:**
     ```json
     {
       "id": 1
     }
     ```

2. Удаление учетной записи пользователя
    - **Метод:** DELETE
    - **URL:** /user/{user_id}
    - **Описание:** Удаление учетной записи пользователя.
    - **Параметры запроса:**
      - `user_id` (integer): Идентификатор пользователя, чью учетную запись требуется удалить.
    - **Ответ:** Код состояния HTTP 200 в случае успешного удаления.
    - **Возможные коды ответов:**
       - 200 OK: Успешное удаление.
       - 404 Not Found: Пользователь не найден.

 ### Объекты строительства
 1. Добавление объекта строительства
    - **Метод:** POST
    - **URL:** /construction_object 
    - **Описание:** Добавляет новый объект строительства.
    - **Параметры запроса:**
       - `address` (строка, обязательно) - адрес объекта строительства.
       - `type` (строка, необязательно) - тип объекта строительства.
    - **Ответ:** Идентификатор нового пользователя. Формат -  JSON
    - **Возможные коды ответов:**
       - 200 OK
       - 422 Validation Error: Некорректный формат данных
         
     **Пример запроса:**
     ```json
      { 
         "address": "Улица Пушкина, дом Колотушкина",
         "type": "Жилой дом"
      }
     ```
     **Пример ответа:**
     ```json
       {
         "id": 1
       }
     ```    
 2. Получнение всех объектов строительства
   - **Метод:** GET
   - **URL:** /construction_object 
   - **Описание:** Возвращает список всех объектов строительства.
   - **Ответ:** Список объектов строительства. Формат -  JSON
   - **Возможные коды ответов:**
      - 200 OK
     
     **Пример ответа:**
     ```json
       [
         {
           "id": 1,
           "address": "Улица Пушкина, дом Колотушкина",
           "type": "Жилой дом"
         },
         {
           "id": 2,
           "address": "Площадь Ленина, дом Карлсона",
           "type": "Административное здание"
         }
       ]
 
 ### Обработка нарушений    
 1. Добавление информации о нарушении
    - **Метод:** POST
    - **URL:** /violation
    - **Описание:**  Представитель УСК добавляет информацию о нарушении.
    - **Параметры запроса:**
      - `description` (строка, обязательно) - описание нарушения.
      - `location` (строка, обязательно) - местоположение нарушения.
      - `date` (строка в формате "yyyy-dd-mm.", обязательно) - дата нарушения.
      - `resolution_status` (строка, обязательно) - статус решения нарушения.
      - `contractor_id` (число, обязательно) - идентификатор подрядчика, ответственного за нарушение.
      - `supervisor_id` (число, обязательно) - идентификатор надзирателя, зарегистрировавшего нарушение.
      - `construction_object_id` (число, обязательно) - идентификатор объекта строительства, на котором произошло нарушение.
      - `violation_classifier` (строка, обязательно) - классификатор нарушения.
    - **Ответ:** Идентификатор нового нарушения. Формат -  JSON.
    - **Возможные коды ответов**
      - 200 OK
      - 422 Validation Error: Некорректный формат данных
     
     **Пример запроса:**
     ```json
      { 
         "description": "Нарушение безопасности",
         "location": "Стройплощадка",
         "date": "2022-12-12",
         "resolution_status": "Открыто",
         "contractor_id": 1,
         "supervisor_id": 2,
         "construction_object_id": 1,
         "violation_classifier": "Безопасность"
      }
     ```
     **Пример ответа:**
     ```json
       {
         "id": 1
       }
     ```
 2. Получение нарушений по подрядчику
    - **Метод:** GET
    - **URL:** /violation/by_contractor_id
    - **Описание:**  Получает список нарушений, связанных с определенным подрядчиком.
    - **Параметры запроса:**
      - `contractor_id` (число, обязательно) - идентификатор подрядчика.
    - **Ответ:** Список нарушений у определенного подрядчика. Формат -  JSON
    - **Возможные коды ответов:**
      - 200 OK
      - 422 Validation Error: Некорректный формат данных
     
    **Пример запроса** GET violation/by_contractor_id?contractor_id=1
     
    **Пример ответа:**
    ```json
       [
         {
           "id": 1,
           "description": "Нарушение безопасности",
           "location": "Стройплощадка",
           "date": "2022-12-12",
           "resolution_status": "Открыто",
           "contractor_id": 1,
           "supervisor_id": 2,
           "construction_object_id": 1,
           "violation_classifier": "Безопасность"
         },
         {
           "id": 2,
           "description": "Нарушение порядка",
           "location": "Территория строительства",
           "date": "2022-10-10",
           "resolution_status": "В работе",
           "contractor_id": 1,
           "supervisor_id": 3,
           "construction_object_id": 1,
           "violation_classifier": "Порядок"
         }
       ]
     ```
3. Получение нарушений по объекту строительства
    - **Метод:** GET
    - **URL:** /violation/by_construction_object_id 
    - **Описание:**  Получает список нарушений, связанных с определенным объектом строительства.
    - **Параметры запроса:**
      - `construction_object_id` (число, обязательно) - идентификатор объекта строительства.
    - **Ответ:** Список нарушений указанного объекта строительства. Формат -  JSON
    - **Возможные коды ответов:**
      - 200 OK
      - 422 Validation Error: Некорректный формат данных
     
    **Пример запроса** GET violation/by_construction_object_id?construction_object_id=1
     
    **Пример ответа:**
    ```json
       [
         {
           "id": 1,
           "description": "Нарушение безопасности",
           "location": "Стройплощадка",
           "date": "2022-12-12",
           "resolution_status": "Открыто",
           "contractor_id": 3,
           "supervisor_id": 2,
           "construction_object_id": 1,
           "violation_classifier": "Безопасность"
         },
         {
           "id": 2,
           "description": "Нарушение порядка",
           "location": "Территория строительства",
           "date": "2022-10-10",
           "resolution_status": "В работе",
           "contractor_id": 8,
           "supervisor_id": 3,
           "construction_object_id": 1,
           "violation_classifier": "Порядок"
         }
       ]
     ``` 
4.  Удаление нарушения
    - **Метод:** DELETE
    - **URL:** /violation{violation_id}
    - **Описание:**  Удаление нарушения.
    - **Параметры запроса:**
      - `violation_id` (число, обязательно) - идентификатор нарушения, для которого отменяется назначение подрядчика.
    - **Ответ:** Код состояния HTTP 200 в случае успешного удаления.
    - **Возможные коды ответов:**
      - 200 OK
      - 404 Not Found: Нарушение не найдено.
      
    **Пример запроса** DELETE /violation1
    
6. Изменение статуса нарушения
    - **Метод:** PUT
    - **URL:** /violation
    - **Описание:**  Изменение статуса нарушения.
    - **Параметры запроса:**
      - `violation_id` (число, обязательно) - идентификатор нарушения, для которого отменяется назначение подрядчика.
      - `new_status` (строка, обязательно) - новый статус
    - **Ответ:** Код состояния HTTP 200 в случае успешного удаления.
    - **Возможные коды ответов:**
      - 200 OK
      - 404 Not Found: Нарушение не найдено.
      - 
**Пример запроса:**
```json
 { 
     "id": 3,
     "new_status": "В работе"
 }
```
     
 ## Тестирование API
 ### Создание пользователя
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/f77c01c4-7b95-490e-8057-332b9b2fcb9c)
 ### Получнение всех объектов строительства
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/f80718b8-36ac-425c-8e85-08938a441e2b)
 ### Создание объекта строительства
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/67bfc33a-31e3-417e-8814-fefef9db5598)
 ### Создание нарушения
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/35add079-fec9-4980-9a46-6c6afd7c68bd)
 ### Получение нарушений по объекту строительства
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/4f2523ad-5670-4e55-beb6-8dac7878ba17)
 ### Получение нарушений по подрядчику
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/6d73b6b6-0eea-480f-a4b7-7804d1b8cebd)
 ### Удаление нарушения
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/cd785b2d-2198-407a-b36b-b3f0c8be3f63)
 ### Изменение статуса нарушения
 ![image](https://github.com/ValeriaSuhinina/hse_paps/assets/126563738/0a306f7a-16ac-42ca-a0c5-5d833a732e08)
